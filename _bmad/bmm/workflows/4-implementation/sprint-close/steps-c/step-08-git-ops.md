---
name: 'step-08-git-ops'
description: 'PrÃ©parer les opÃ©rations Git : push, PR, merge, tag, nouvelle branche'
nextStepFile: './step-09-report.md'
statusFile: '{implementation_artifacts}/sprint-close-status.yaml'
---

# Step 8: OpÃ©rations Git

## STEP GOAL:

PrÃ©parer et guider les opÃ©rations Git pour finaliser la release. Les agents n'ont PAS les permissions pour crÃ©er des PR ou merger - fournir des instructions claires Ã  l'utilisateur.

## MANDATORY EXECUTION RULES (READ FIRST):

### Universal Rules:

- ğŸ“– CRITICAL: Follow Git best practices
- ğŸ”„ CRITICAL: Verify each step before proceeding
- âœ… Communicate in {communication_language}

### Step-Specific Rules:

- âš ï¸ CRITICAL: Agents do NOT have permissions for PR/merge operations
- ğŸ¯ Push is allowed, PR/merge/tag require user action
- ğŸ’¬ In interactive mode: guide user through each step
- ğŸ“ In YOLO mode: prepare all instructions for final report

## EXECUTION PROTOCOLS:

- ğŸ¯ Verify clean working directory before operations
- ğŸ’¾ Create meaningful commit messages
- ğŸ“– Provide copy-paste ready commands for user

## MANDATORY SEQUENCE

### 1. Verify Git State

Check current state:

```bash
git status
git branch --show-current
git log origin/{main_branch}..HEAD --oneline
```

Display:

"**ğŸ”€ OpÃ©rations Git**

Branche actuelle : {current_branch}
Ã‰tat : {clean/dirty}
Commits en avance : {count}"

IF working directory is dirty:
- Commit remaining changes with message: "chore: sprint-close updates for Epic {epic_number}"

### 2. Push to Remote (Agent CAN do this)

```bash
git push origin {current_branch}
```

IF push succeeds:
  Display: "âœ… Push effectuÃ© avec succÃ¨s"

IF push fails:
  Display error and instructions for manual push

### 3. Prepare PR/Merge Instructions (Agent CANNOT do this)

**Generate PR content:**

```yaml
pr_content:
  title: "Release: Epic {epic_number} - {epic_name}"
  body: |
    ## Summary
    {changelog_content}

    ## Validation Results
    - Tests: {tests_status}
    - Docker: {docker_status}
    - Code Review: {review_status}

    ---
    Generated by sprint-close workflow
  base: main
  head: {current_branch}
```

```
IF mode == interactive:
  Display:
  "**ğŸ“ CrÃ©ation de Pull Request**

  L'agent n'a pas les permissions pour crÃ©er une PR.
  Voici les instructions :

  **Option 1 - Via GitHub CLI :**
  ```
  gh pr create --title \"Release: Epic {epic_number} - {epic_name}\" --body \"$(cat <<'EOF'
  {pr_body_content}
  EOF
  )\" --base main --head {current_branch}
  ```

  **Option 2 - Via l'interface GitHub :**
  1. Allez sur : https://github.com/{owner}/{repo}/compare/main...{current_branch}
  2. Titre : Release: Epic {epic_number} - {epic_name}
  3. Copiez le contenu du changelog dans la description

  [D] Done - PR crÃ©Ã©e
  [S] Skip - Je ferai plus tard"

  Wait for user choice
  IF D: Ask for PR URL, store it
  IF S: Log for report

IF mode == yolo:
  Store instructions in status file for final report
  Display: "Instructions PR/merge prÃ©parÃ©es pour le rapport final"
```

### 4. Prepare Merge Instructions

```
IF mode == interactive AND pr_created:
  Display:
  "**ğŸ”€ Merge de la PR**

  Une fois la PR approuvÃ©e, mergez-la :

  **Via GitHub CLI :**
  ```
  gh pr merge {pr_number} --merge --delete-branch
  ```

  **Via l'interface GitHub :**
  1. Allez sur la PR
  2. Cliquez sur 'Merge pull request'
  3. Confirmez le merge

  [D] Done - PR mergÃ©e
  [S] Skip - Je ferai plus tard"

  Wait for user choice

IF mode == yolo:
  Store instructions for report
```

### 5. Prepare Tag Instructions

```
tag_instructions:
  commands: |
    # AprÃ¨s le merge sur main :
    git checkout main
    git pull origin main
    git tag -a v{epic_number}.0 -m "Release Epic {epic_number}: {epic_name}"
    git push origin v{epic_number}.0
```

```
IF mode == interactive:
  Display:
  "**ğŸ·ï¸ CrÃ©ation du tag de release**

  AprÃ¨s le merge, crÃ©ez le tag :

  ```bash
  git checkout main
  git pull origin main
  git tag -a v{epic_number}.0 -m \"Release Epic {epic_number}: {epic_name}\"
  git push origin v{epic_number}.0
  ```

  [D] Done - Tag crÃ©Ã©
  [S] Skip - Je ferai plus tard"

IF mode == yolo:
  Store for report
```

### 6. Prepare Next Branch Instructions

```
next_branch_instructions:
  branch_name: "epic-{next_epic_number}-{next_epic_name_slug}"
  commands: |
    # CrÃ©er la branche pour le prochain epic :
    git checkout main
    git pull origin main
    git checkout -b epic-{next_epic_number}-{next_epic_name_slug}
    git push -u origin epic-{next_epic_number}-{next_epic_name_slug}
```

```
IF mode == interactive:
  Display:
  "**ğŸŒ¿ CrÃ©ation de la branche pour le prochain epic**

  ```bash
  git checkout main
  git pull origin main
  git checkout -b epic-{next_epic_number}-{next_epic_name_slug}
  git push -u origin epic-{next_epic_number}-{next_epic_name_slug}
  ```

  [D] Done - Branche crÃ©Ã©e
  [S] Skip - Je ferai plus tard"

IF mode == yolo:
  Store for report
```

### 7. Update Status and Proceed

Update `{statusFile}`:

```yaml
git_ops:
  status: "completed" | "partial" | "instructions_only"
  pushed: true/false
  pr:
    created: true/false/pending
    url: "{url}" | null
    merged: true/false/pending
  tag:
    created: true/false/pending
    name: "v{epic_number}.0"
  next_branch:
    created: true/false/pending
    name: "epic-{next}-{name}"
  manual_instructions:
    pr_commands: "..."
    merge_commands: "..."
    tag_commands: "..."
    branch_commands: "..."

stepsCompleted: [..., "step-08-git-ops"]
current_step: "step-09-report"
```

Display:

"**âœ… PrÃ©paration Git terminÃ©e**

| OpÃ©ration | Statut |
|-----------|--------|
| Push | {done/pending} |
| Pull Request | {url or 'Instructions prÃ©parÃ©es'} |
| Merge | {done or 'Instructions prÃ©parÃ©es'} |
| Tag | {done or 'Instructions prÃ©parÃ©es'} |
| Nouvelle branche | {done or 'Instructions prÃ©parÃ©es'} |

**Prochaine Ã©tape :** Rapport final"

â†’ Load and execute `{nextStepFile}`

---

## ğŸš¨ SYSTEM SUCCESS/FAILURE METRICS

### âœ… SUCCESS:

- Git state verified
- Push attempted (success or clear error)
- Clear instructions provided for PR/merge/tag/branch
- All commands are copy-paste ready
- Status file updated with all instructions

### âŒ SYSTEM FAILURE:

- Attempting PR/merge operations that will fail
- Not providing clear instructions
- Missing copy-paste commands
- Leaving user without guidance
